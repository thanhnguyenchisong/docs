# Security & Vulnerability Scanning - Câu hỏi phỏng vấn Harbor

## Mục lục
1. [RBAC và Project](#rbac-và-project)
2. [Vulnerability scanning](#vulnerability-scanning)
3. [Image signing (Notary)](#image-signing-notary)
4. [Robot account](#robot-account)
5. [Câu hỏi thường gặp](#câu-hỏi-thường-gặp)

---

## RBAC và Project

- **Role** trong project Harbor:
  - **Project Admin**: Quản lý member, config project, replication, quota.
  - **Developer**: Push/pull image, xóa repo/tag (tùy cấu hình).
  - **Guest**: Chỉ pull (read).
  - **Maintainer**: Push/pull, quản lý repo (không quản member).

- **User** được thêm vào project với một role. **LDAP/OIDC**: User đồng bộ từ LDAP/AD hoặc OIDC; gán vào project tương tự.
- **Quyền** áp dụng theo project: User A có thể là admin project X, guest project Y.

---

## Vulnerability scanning

- Harbor tích hợp **scanner** (Trivy, Clair) để quét **CVE** trong image (OS package, application dependency).
- **Cách dùng**: Trong project/repository, chọn **Scan** (manual hoặc scan on push nếu bật). Kết quả: danh sách CVE (critical, high, medium, low), link chi tiết.
- **Policy**: Có thể cấu hình “prevent deploy when critical/high” (block pull hoặc chỉ cảnh báo trong UI). **Replication** có thể chỉ replicate image đã pass policy (tùy cấu hình).

→ Giúp không deploy image có vulnerability đã biết; cần cập nhật base image và dependency.

---

## Image signing (Notary)

- **Notary** (content trust): Ký **tag** của image (không ký layer). Khi pull có thể **verify** chữ ký (client hoặc Harbor) để đảm bảo image chưa bị sửa.
- **Luồng**: Developer push image → ký tag bằng notary client; Harbor lưu signature. Môi trường deploy chỉ chấp nhận image đã ký (policy).
- **Ghi chú**: Notary đôi khi cấu hình phức tạp; một số môi trường dùng “chỉ pull từ Harbor + scan” thay vì ký.

---

## Robot account

- **Robot account**: Tài khoản máy (không phải user LDAP/OIDC) dùng cho **CI/CD**: push/pull từ pipeline. Tạo trong project, gán quyền (push+pull hoặc chỉ pull); có **token** (username + secret) để docker login.
- **Ưu điểm**: Không dùng password user thật; có thể revoke từng robot; scope theo project.

---

## Câu hỏi thường gặp

### Scanner Trivy vs Clair?

- **Trivy**: Phổ biến, dễ deploy, scan nhanh; hỗ trợ OS + app dependency. **Clair**: Cũ hơn, mạnh về OS layer. Harbor hỗ trợ cả hai (cài adapter tương ứng). Chọn theo chuẩn team và CVE database cần dùng.

### Image không scan được?

- Có thể do scanner chưa support OS/arch (ví dụ image arm64); hoặc scanner service lỗi. Xem log job scan trong Harbor; đảm bảo scanner adapter đã cấu hình đúng và chạy.

---

**Tiếp theo:** [05-CI-CD-Best-Practices.md](./05-CI-CD-Best-Practices.md)
